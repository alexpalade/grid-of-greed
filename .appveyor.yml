image:
  - Visual Studio 2017

platform:
  - x64

environment:
  global:
    GAMEKIT_SYSTEM_NAME: gridgreed
    GAMEKIT_APPLICATION_PACKAGE: gridgreed
    GAMEKIT_APPLICATION_MAIN_CLASS: gridgreed
    GAMEKIT_ARTIFACT: $(GAMEKIT_SYSTEM_NAME)-x86-64-windows-$(APPVEYOR_REPO_TAG_NAME).zip
    GAMEKIT_BUILD_DIR: $(TMP)\$(GAMEKIT_SYSTEM_NAME)

skip_non_tags: true

branches:
  only:
    - master
    - "/^v\\d+(\\.\\d+)+$/"

install:
  - set PATH=C:\msys64\usr\bin\;%PATH%
  - pacman --noconfirm -Syu
  - pacman --noconfirm -S zip
  - sh -c "curl -L http://bodge.borodust.org/files/install.sh | sh"

build_script:
  - >
    sh -c "$HOME/bin/lisp $HOME/bodge/scripts/build-gamekit-system.lisp
    %GAMEKIT_SYSTEM_NAME% %GAMEKIT_APPLICATION_PACKAGE% %GAMEKIT_APPLICATION_MAIN_CLASS%
    $(cygpath -u '%APPVEYOR_BUILD_FOLDER%')
    $(cygpath -u '%GAMEKIT_BUILD_DIR%')"
  - mv %GAMEKIT_BUILD_DIR%\%GAMEKIT_SYSTEM_NAME%.zip %GAMEKIT_ARTIFACT%

artifacts:
  - path: "%GAMEKIT_ARTIFACT%"
    name: release_archive

deploy:
  provider: GitHub
  release: $(APPVEYOR_REPO_TAG_NAME)
  tag: $(APPVEYOR_REPO_TAG_NAME)
  description: $(APPVEYOR_REPO_COMMIT_MESSAGE)
  auth_token:
    secure: "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"
  artifact: release_archive
  force_update: true
  draft: false
  prerelease: false
  on:
    appveyor_repo_tag: true
